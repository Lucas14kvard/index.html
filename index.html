<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Профиль Lucas_14kvard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron&display=swap');
  body {
    margin: 0; padding: 0;
    font-family: 'Orbitron', monospace;
    background: linear-gradient(135deg, #7c4dff, #ff7acc);
    color: white;
    min-height: 100vh;
    display: flex; flex-direction: column;
    align-items: center;
  }
  header {
    position: relative;
    width: 100%; max-width: 900px;
    height: 300px;
    background: #4b1d64;
    overflow: hidden;
    margin-top: 10px;
    border-radius: 15px;
  }
  #banner {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    object-fit: cover;
    filter: brightness(0.6);
    cursor: pointer;
  }
  #banner.empty {
    background: #59107d;
  }
  #bannerRemoveBtn {
    position: absolute;
    top: 8px; right: 8px;
    background: #0a870a;
    border: none;
    padding: 6px 14px;
    font-weight: bold;
    font-size: 18px;
    border-radius: 5px;
    cursor: pointer;
    display: none;
    color: white;
    z-index: 10;
  }
  #avatarWrapper {
    position: absolute;
    bottom: -70px;
    left: 50%;
    transform: translateX(-50%);
    width: 160px; height: 160px;
    border-radius: 50%;
    border: 5px solid #0a870a;
    background: #ddd;
    overflow: hidden;
    cursor: pointer;
    z-index: 20;
  }
  #avatar {
    width: 100%; height: 100%;
    object-fit: cover;
  }
  #avatar.empty {
    background: #999;
  }
  #username {
    position: absolute;
    bottom: -110px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 2rem;
    font-weight: bold;
    color: #0a870a;
    text-shadow: 0 0 6px black;
    outline: none;
    cursor: text;
    min-width: 220px;
    max-width: 320px;
    text-align: center;
    user-select: text;
  }
  nav {
    margin-top: 90px;
    width: 100%; max-width: 900px;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  nav button {
    background: #0a870a;
    border: none;
    padding: 10px 30px;
    font-size: 1.2rem;
    font-weight: bold;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s;
  }
  nav button.active,
  nav button:hover {
    background: #12d412;
  }
  main {
    margin-top: 60px;
    width: 100%; max-width: 900px;
    flex: 1;
    min-height: 300px;
  }
  section {
    display: none;
  }
  section.active {
    display: block;
  }
  #profileSection {
    text-align: center;
  }
  #statusInput {
    width: 80%;
    max-width: 400px;
    font-size: 1.3rem;
    padding: 10px;
    border-radius: 10px;
    border: none;
    margin-top: 15px;
    color: #0a870a;
    background: #eee;
    font-family: 'Orbitron', monospace;
    font-weight: bold;
    outline: none;
  }
  #postsList {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  .postCard {
    background: rgba(0,0,0,0.3);
    border-radius: 15px;
    width: 260px;
    box-shadow: 0 0 8px #0a870a;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .postImage {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }
  .postCaption {
    padding: 10px;
    background: rgba(10,135,10,0.9);
    font-weight: 600;
    font-size: 1rem;
  }
  .postHashtags {
    font-size: 0.85rem;
    color: #b3ffb3;
    padding: 6px 10px 10px;
  }
  #addForm {
    max-width: 500px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  #addForm textarea,
  #addForm input[type="text"] {
    padding: 10px;
    font-size: 1.1rem;
    border-radius: 10px;
    border: none;
    resize: vertical;
    font-family: 'Orbitron', monospace;
    font-weight: bold;
  }
  #addForm input[type="file"] {
    color: white;
  }
  #addForm button {
    background: #0a870a;
    border: none;
    color: white;
    font-size: 1.2rem;
    padding: 12px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
  }
  #addForm button:hover {
    background: #12d412;
  }
  /* Подпись над фото */
  .postCaptionTop {
    background: rgba(0,0,0,0.7);
    padding: 6px 12px;
    font-weight: bold;
    font-size: 1rem;
    color: #0a870a;
    text-align: center;
    border-radius: 0 0 15px 15px;
  }
</style>
</head>
<body>

<header>
  <img id="banner" class="empty" alt="Баннер" title="Нажмите, чтобы сменить баннер" />
  <button id="bannerRemoveBtn" title="Удалить баннер">✕</button>

  <label id="avatarWrapper" title="Нажмите, чтобы сменить аватар">
    <img id="avatar" class="empty" alt="Аватар" />
    <input type="file" id="avatarInput" accept="image/*" style="display:none" />
  </label>

  <input type="file" id="bannerInput" accept="image/*" style="display:none" />

  <div id="username" contenteditable="true" spellcheck="false" title="Нажмите, чтобы изменить ник">Lucas_14kvard</div>
</header>

<nav>
  <button id="tabProfile" class="active">Профиль</button>
  <button id="tabGeneral">Общее</button>
  <button id="tabAdd">Добавить</button>
</nav>

<main>
  <section id="profileSection" class="active">
    <input id="statusInput" type="text" placeholder="Введите статус..." />
  </section>

  <section id="generalSection">
    <div id="postsList"></div>
  </section>

  <section id="addSection">
    <form id="addForm">
      <textarea id="postCaption" placeholder="Подпись к фото..." rows="3" required></textarea>
      <input id="postHashtags" type="text" placeholder="Хештеги через пробел, например: #булочки #аквапарк" />
      <input id="postImageInput" type="file" accept="image/*" required />
      <button type="submit">Добавить пост</button>
    </form>
  </section>
</main>

<script>
  // Сохраняем и загружаем данные из localStorage
  const storage = {
    get(key) {
      return JSON.parse(localStorage.getItem(key));
    },
    set(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }
  };

  // Элементы DOM
  const banner = document.getElementById('banner');
  const bannerInput = document.getElementById('bannerInput');
  const bannerRemoveBtn = document.getElementById('bannerRemoveBtn');

  const avatar = document.getElementById('avatar');
  const avatarInput = document.getElementById('avatarInput');

  const username = document.getElementById('username');
  const statusInput = document.getElementById('statusInput');

  const tabs = {
    profile: document.getElementById('tabProfile'),
    general:
      const tabs = {
  profile: document.getElementById('tabProfile'),
  general: document.getElementById('tabGeneral'),
  add: document.getElementById('tabAdd')
};

const sections = {
  profile: document.getElementById('profileSection'),
  general: document.getElementById('generalSection'),
  add: document.getElementById('addSection')
};

const postsList = document.getElementById('postsList');
const addForm = document.getElementById('addForm');
const postCaption = document.getElementById('postCaption');
const postHashtags = document.getElementById('postHashtags');
const postImageInput = document.getElementById('postImageInput');

// Функция для переключения вкладок
function switchTab(tabName) {
  for (const key in tabs) {
    if (key === tabName) {
      tabs[key].classList.add('active');
      sections[key].classList.add('active');
    } else {
      tabs[key].classList.remove('active');
      sections[key].classList.remove('active');
    }
  }
}

// Обработчики вкладок
tabs.profile.addEventListener('click', () => switchTab('profile'));
tabs.general.addEventListener('click', () => switchTab('general'));
tabs.add.addEventListener('click', () => switchTab('add'));

// Загрузка данных с localStorage при старте
function loadProfile() {
  const storedBanner = storage.get('profileBanner');
  if (storedBanner) {
    banner.src = storedBanner;
    banner.classList.remove('empty');
    bannerRemoveBtn.style.display = 'block';
  } else {
    banner.src = '';
    banner.classList.add('empty');
    bannerRemoveBtn.style.display = 'none';
  }

  const storedAvatar = storage.get('profileAvatar');
  if (storedAvatar) {
    avatar.src = storedAvatar;
    avatar.classList.remove('empty');
  } else {
    avatar.src = '';
    avatar.classList.add('empty');
  }

  const storedUsername = storage.get('profileUsername');
  if (storedUsername) {
    username.textContent = storedUsername;
  } else {
    username.textContent = 'Lucas_14kvard';
  }

  const storedStatus = storage.get('profileStatus');
  if (storedStatus) {
    statusInput.value = storedStatus;
  } else {
    statusInput.value = '';
  }
}

function loadPosts() {
  const posts = storage.get('posts') || [];
  postsList.innerHTML = '';
  posts.forEach(post => {
    const card = document.createElement('div');
    card.className = 'postCard';

    const img = document.createElement('img');
    img.className = 'postImage';
    img.src = post.image;
    img.alt = 'Фото поста';
    card.appendChild(img);

    if (post.caption) {
      const caption = document.createElement('div');
      caption.className = 'postCaption';
      caption.textContent = post.caption;
      card.appendChild(caption);
    }

    if (post.hashtags && post.hashtags.length > 0) {
      const hashtags = document.createElement('div');
      hashtags.className = 'postHashtags';
      hashtags.textContent = post.hashtags.join(' ');
      card.appendChild(hashtags);
    }

    postsList.appendChild(card);
  });
}

// Сохраняем аватар
avatarInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    avatar.src = reader.result;
    avatar.classList.remove('empty');
    storage.set('profileAvatar', reader.result);
  };
  reader.readAsDataURL(file);
});

// Сохраняем баннер
bannerInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    banner.src = reader.result;
    banner.classList.remove('empty');
    bannerRemoveBtn.style.display = 'block';
    storage.set('profileBanner', reader.result);
  };
  reader.readAsDataURL(file);
});

// Клик по баннеру для загрузки нового
banner.addEventListener('click', () => {
  bannerInput.click();
});

// Удаление баннера
bannerRemoveBtn.addEventListener('click', e => {
  e.stopPropagation();
  banner.src = '';
  banner.classList.add('empty');
  bannerRemoveBtn.style.display = 'none';
  storage.set('profileBanner', null);
});

// Клик по аватару — открыть выбор файла
document.getElementById('avatarWrapper').addEventListener('click', () => {
  avatarInput.click();
});

// Сохраняем имя пользователя по потере фокуса
username.addEventListener('blur', () => {
  storage.set('profileUsername', username.textContent.trim() || 'Lucas_14kvard');
});

// Сохраняем статус при вводе с небольшой задержкой (дебаунс)
let statusTimeout;
statusInput.addEventListener('input', () => {
  clearTimeout(statusTimeout);
  statusTimeout = setTimeout(() => {
    storage.set('profileStatus', statusInput.value.trim());
  }, 500);
});

// Добавление нового поста
addForm.addEventListener('submit', e => {
  e.preventDefault();
  const file = postImageInput.files[0];
  if (!file) {
    alert('Пожалуйста, выберите изображение.');
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    const posts = storage.get('posts') || [];
    const hashtagsArray = postHashtags.value
      .trim()
      .split(/\s+/)
      .filter(tag => tag.startsWith('#'));

    posts.unshift({
      image: reader.result,
      caption: postCaption.value.trim(),
      hashtags: hashtagsArray
    });

    storage.set('posts', posts);

    // Очистить форму
    addForm.reset();

    // Переключиться на общий таб и обновить список постов
    switchTab('general');
    loadPosts();
  };
  reader.readAsDataURL(file);
});

// Начальная загрузка
loadProfile();
loadPosts();
</script>
